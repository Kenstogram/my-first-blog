from django.contrib.gis import gdal
<<<<<<< HEAD
from django.utils import six
from django.utils.encoding import python_2_unicode_compatible


@python_2_unicode_compatible
class SpatialRefSysMixin(object):
=======


class SpatialRefSysMixin:
>>>>>>> 37c99181c9a6b95433d60f8c8ef9af5731096435
    """
    The SpatialRefSysMixin is a class used by the database-dependent
    SpatialRefSys objects to reduce redundant code.
    """
    @property
    def srs(self):
        """
<<<<<<< HEAD
        Returns a GDAL SpatialReference object.
=======
        Return a GDAL SpatialReference object.
>>>>>>> 37c99181c9a6b95433d60f8c8ef9af5731096435
        """
        # TODO: Is caching really necessary here?  Is complexity worth it?
        if hasattr(self, '_srs'):
            # Returning a clone of the cached SpatialReference object.
            return self._srs.clone()
        else:
            # Attempting to cache a SpatialReference object.

            # Trying to get from WKT first.
            try:
                self._srs = gdal.SpatialReference(self.wkt)
                return self.srs
            except Exception as e:
                msg = e

            try:
                self._srs = gdal.SpatialReference(self.proj4text)
                return self.srs
            except Exception as e:
                msg = e

            raise Exception('Could not get OSR SpatialReference from WKT: %s\nError:\n%s' % (self.wkt, msg))

    @property
    def ellipsoid(self):
        """
<<<<<<< HEAD
        Returns a tuple of the ellipsoid parameters:
=======
        Return a tuple of the ellipsoid parameters:
>>>>>>> 37c99181c9a6b95433d60f8c8ef9af5731096435
        (semimajor axis, semiminor axis, and inverse flattening).
        """
        return self.srs.ellipsoid

    @property
    def name(self):
<<<<<<< HEAD
        "Returns the projection name."
=======
        "Return the projection name."
>>>>>>> 37c99181c9a6b95433d60f8c8ef9af5731096435
        return self.srs.name

    @property
    def spheroid(self):
<<<<<<< HEAD
        "Returns the spheroid name for this spatial reference."
=======
        "Return the spheroid name for this spatial reference."
>>>>>>> 37c99181c9a6b95433d60f8c8ef9af5731096435
        return self.srs['spheroid']

    @property
    def datum(self):
<<<<<<< HEAD
        "Returns the datum for this spatial reference."
=======
        "Return the datum for this spatial reference."
>>>>>>> 37c99181c9a6b95433d60f8c8ef9af5731096435
        return self.srs['datum']

    @property
    def projected(self):
        "Is this Spatial Reference projected?"
        return self.srs.projected

    @property
    def local(self):
        "Is this Spatial Reference local?"
        return self.srs.local

    @property
    def geographic(self):
        "Is this Spatial Reference geographic?"
        return self.srs.geographic

    @property
    def linear_name(self):
<<<<<<< HEAD
        "Returns the linear units name."
=======
        "Return the linear units name."
>>>>>>> 37c99181c9a6b95433d60f8c8ef9af5731096435
        return self.srs.linear_name

    @property
    def linear_units(self):
<<<<<<< HEAD
        "Returns the linear units."
=======
        "Return the linear units."
>>>>>>> 37c99181c9a6b95433d60f8c8ef9af5731096435
        return self.srs.linear_units

    @property
    def angular_name(self):
<<<<<<< HEAD
        "Returns the name of the angular units."
=======
        "Return the name of the angular units."
>>>>>>> 37c99181c9a6b95433d60f8c8ef9af5731096435
        return self.srs.angular_name

    @property
    def angular_units(self):
<<<<<<< HEAD
        "Returns the angular units."
=======
        "Return the angular units."
>>>>>>> 37c99181c9a6b95433d60f8c8ef9af5731096435
        return self.srs.angular_units

    @property
    def units(self):
<<<<<<< HEAD
        "Returns a tuple of the units and the name."
=======
        "Return a tuple of the units and the name."
>>>>>>> 37c99181c9a6b95433d60f8c8ef9af5731096435
        if self.projected or self.local:
            return (self.linear_units, self.linear_name)
        elif self.geographic:
            return (self.angular_units, self.angular_name)
        else:
            return (None, None)

    @classmethod
    def get_units(cls, wkt):
        """
        Return a tuple of (unit_value, unit_name) for the given WKT without
        using any of the database fields.
        """
        return gdal.SpatialReference(wkt).units

    @classmethod
    def get_spheroid(cls, wkt, string=True):
        """
        Class method used by GeometryField on initialization to
        retrieve the `SPHEROID[..]` parameters from the given WKT.
        """
        srs = gdal.SpatialReference(wkt)
        sphere_params = srs.ellipsoid
        sphere_name = srs['spheroid']

        if not string:
            return sphere_name, sphere_params
        else:
            # `string` parameter used to place in format acceptable by PostGIS
            if len(sphere_params) == 3:
                radius, flattening = sphere_params[0], sphere_params[2]
            else:
                radius, flattening = sphere_params
            return 'SPHEROID["%s",%s,%s]' % (sphere_name, radius, flattening)

    def __str__(self):
        """
<<<<<<< HEAD
        Returns the string representation, a 'pretty' OGC WKT.
        """
        return six.text_type(self.srs)
=======
        Return the string representation, a 'pretty' OGC WKT.
        """
        return str(self.srs)
>>>>>>> 37c99181c9a6b95433d60f8c8ef9af5731096435
