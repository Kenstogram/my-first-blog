<<<<<<< HEAD
from django import http
from django.conf import settings
=======
from django.conf import settings
from django.http import HttpResponse
>>>>>>> 37c99181c9a6b95433d60f8c8ef9af5731096435
from django.utils.deprecation import MiddlewareMixin

from .utils import get_view_name


class XViewMiddleware(MiddlewareMixin):
    """
<<<<<<< HEAD
    Adds an X-View header to internal HEAD requests -- used by the documentation system.
=======
    Add an X-View header to internal HEAD requests.
>>>>>>> 37c99181c9a6b95433d60f8c8ef9af5731096435
    """
    def process_view(self, request, view_func, view_args, view_kwargs):
        """
        If the request method is HEAD and either the IP is internal or the
<<<<<<< HEAD
        user is a logged-in staff member, quickly return with an x-header
        indicating the view function.  This is used by the documentation module
        to lookup the view function for an arbitrary page.
=======
        user is a logged-in staff member, return a responsewith an x-view
        header indicating the view function. This is used to lookup the view
        function for an arbitrary page.
>>>>>>> 37c99181c9a6b95433d60f8c8ef9af5731096435
        """
        assert hasattr(request, 'user'), (
            "The XView middleware requires authentication middleware to be "
            "installed. Edit your MIDDLEWARE%s setting to insert "
            "'django.contrib.auth.middleware.AuthenticationMiddleware'." % (
                "_CLASSES" if settings.MIDDLEWARE is None else ""
            )
        )
        if request.method == 'HEAD' and (request.META.get('REMOTE_ADDR') in settings.INTERNAL_IPS or
                                         (request.user.is_active and request.user.is_staff)):
<<<<<<< HEAD
            response = http.HttpResponse()
=======
            response = HttpResponse()
>>>>>>> 37c99181c9a6b95433d60f8c8ef9af5731096435
            response['X-View'] = get_view_name(view_func)
            return response
